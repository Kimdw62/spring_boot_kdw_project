<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="edu.sejong.ex.mapper.UserMapper">

    <insert id="insertUser" parameterType="UserVO">
    <![CDATA[
		insert into users(username, password) values (#{username}, #{password})
    ]]>
    </insert>

    <insert id="insertAuthorities" parameterType="UserVO">
    <![CDATA[
		insert into authorities(username, authority) values (#{username}, 'ROLE_USER'})
    ]]>
    </insert>

	<!-- AuthVO -->
	<resultMap id="authMap" type="AuthVO">
		<result property="username" column="username" />
		<result property="username" column="username" />
	</resultMap>
           
    <resultMap id="userMap" type="UserVO">
    	<id property="username" column="username" />
    	<result property="password" column="password" />
    	<result property="enabled" column="enabled" />
    	<collection property="authList" resultMap="authMap" />
    </resultMap>
       
    <select id="getUser" resultMap="userMap">
    <![CDATA[
		select a.username, a.password, a.enabled, b.authority
		from users a inner join authorities b
		on a.username = b.username
		where a.username = #{username}
    ]]>
    </select>
       
</mapper>
